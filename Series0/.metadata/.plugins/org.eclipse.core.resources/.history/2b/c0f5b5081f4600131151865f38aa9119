module Series1

import lang::java::jdt::m3::AST;
import lang::java::jdt::m3::Core;
import analysis::m3::Core;
import analysis::m3::metrics::LOC;
import IO;
import Set;

int countLinesOfCode(M3 m3){
					
	linesOfCode2 = countSourceLocPerLanguage(m3);
	
	return linesOfCode2["java"];
}

map[str method, int count] countLinesOfCodePerMethod(loc location) {
	 map[str, int] result = ();
	 
	 projectTree = createM3FromEclipseProject(location);
	 
	 methodsList = projectTree@declarations.name;
	 mothodSourcesList = projectTree@declarations.src;
	 
	 for (source <- mothodSourcesList) {
	 	sourceLoc = countLinesOfCode(source);
	 	print(source); print(": "); println(sourceLoc);
	 }
	 
	 return result;
}


void computeMetrics(){
	testProjectLocation = |project://test_java_project|;
	testProjectTree = createM3FromEclipseProject(location);
	smallSqlProjectLocation = |project://smallsql0.21_src|;
	hsqldbProjectLocation = |project://hsqldb-2.3.1|;
	
	// compute LOC - write your own method?
	//testProjectLOC = countLinesOfCode(testProjectTree);
	//print("Test project: "); println(testProjectLOC);
		
	//smallSqlProjectLOC = countLinesOfCode(smallSqlProjectLocation);	
	//print("Small sql project: "); println(smallSqlProjectLOC);
	
	//hsqldbProjectLOC = countLinesOfCode(hsqldbProjectLocation);	
	//print("Hsqldb project: "); println(hsqldbProjectLOC);
	
	// compute complexity per unit
	
	// compute duplication
	
	// compute unit size (LOC / unit)	
	countLinesOfCodePerMethod(testProjectLocation);	
}
